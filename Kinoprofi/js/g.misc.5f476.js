$(function(){if($.inArray(navigator.platform,['iPhone','iPad','iPod','iPhone Simulator'])===-1){var classUp=$.cookie("closeUp")?"disabledUpB":"";$('body').append('<div id="GOWrapper" class="'+classUp+'"><div id="GoUpButton"></div><div id="GoUpText">Наверх</div><div id="GoUpWrapper"><div id="GoUpClickZone"></div></div><div id="GoPrevButton"><span><i></i></span></div><div class="toggleButton" id="closeButton"><i></i>закрыть</div><p class="toggleButton" id="openButton">UP</p></div>');$('.toggleButton').click(function(){var self=$(this);var toggleButton=function(){self.parents("#GOWrapper").toggleClass("disabledUpB")}
if($(this).is('#openButton')){if($('body').scrollTop()==0){var scrollrem=$('html').scrollTop();}else{var scrollrem=$('body').scrollTop();}$('body,html').animate({scrollTop:0},500);$('#GoPrevButton').show().click(function(){$('body,html').scrollTop(scrollrem);});$.cookie("closeUp",null,{path:"/",domain:window.location.host,expires:0});setTimeout(toggleButton,250);}else{$.cookie("closeUp",1,{path:"/",domain:window.location.host,expires:30});toggleButton();}});$('#GoUpClickZone p').hide();var wrapper=$('#GoUpWrapper'),clickZone=$('#GoUpClickZone, #GoUpClickZone p'),upButton=$('#GoUpButton, #GoUpText'),all=$('#GoUpClickZone, #GoUpButton, #GoUpText'),$window=$(window),$body=$('body'),isHidden=true,animationTime=200,mouseInClickZone=false;all.hover(function(e){if(!isHidden&&!(e.clientX===0&&e.clientY===0)){if(wrapper.outerWidth()>=clickZone.outerWidth()){clickZone.stop().fadeTo(animationTime,1);}upButton.stop().fadeTo(animationTime,1);}},function(e){if(!isHidden&&e.clientX>=clickZone.first().outerWidth()){clickZone.stop().fadeTo(animationTime,0);upButton.stop();}}).mouseenter(function(e){if(!(e.clientX===0&&e.clientY===0)){mouseInClickZone=true;}}).mouseleave(function(e){if(e.clientX>=clickZone.first().outerWidth()){mouseInClickZone=false;}}).click(function(){isHidden=true;hideAll();if($('body').scrollTop()==0){var scrollrem=$('html').scrollTop();}else{var scrollrem=$('body').scrollTop();}$('body,html').animate({scrollTop:0},500);$('#GoPrevButton').show().click(function(){$('body,html').scrollTop(scrollrem);});})
var windowScrollTop,windowHeight,documentHeight,bigPage,toggleHeight,toggleTimer,toggleTimerLong;var showAll=function(){if(mouseInClickZone){if(wrapper.outerWidth()>=clickZone.outerWidth()){clickZone.stop().fadeTo(animationTime,1);}upButton.stop().fadeTo(animationTime,1);}else{upButton.stop().fadeTo(animationTime,1);}$('#GoPrevButton').hide();$('.toggleButton, #GoUpWrapper').show();isHidden=false,all.css('cursor','pointer');},hideAll=function(){$('.toggleButton, #GoUpWrapper').hide();upButton.stop().fadeTo(animationTime,0);clickZone.stop().fadeTo(animationTime,0);isHidden=true;all.css('cursor','auto');},toggleVisible=function(){clearTimeout(toggleTimer);clearTimeout(toggleTimerLong);toggleTimerLong=null;windowScrollTop=$window.scrollTop();if(isHidden&&windowScrollTop>toggleHeight){showAll();}else if(!isHidden&&windowScrollTop<=toggleHeight){hideAll();}},doScroll=function(){if(toggleTimer){clearTimeout(toggleTimer);}toggleTimer=setTimeout(toggleVisible,150);if(!toggleTimerLong){toggleTimerLong=setTimeout(toggleVisible,750);}},doResize=function(){var oldBigPage=bigPage;windowHeight=$window.height();documentHeight=$(document).height();bigPage=bigPage||documentHeight/windowHeight>=2;toggleHeight=windowHeight*0.3;if(bigPage&&!oldBigPage){$window.scroll(doScroll);doScroll();}if($('div.shadow').length){wrapper.css('width',Math.min(100,($body.width()-$('div.shadow').outerWidth())/2));clickZone.first().css('width',wrapper.css('width'));}};$window.resize(doResize);doResize();}});(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}}(function($,undefined){'use strict';var prefix='social-likes';var classPrefix=prefix+'__';var openClass=prefix+'_opened';var protocol=location.protocol==='https:'?'https:':'http:';var isHttps=protocol==='https:';var services={facebook:{counterUrl:'https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?',convertNumber:function(data){return data.data[0].total_count;},popupUrl:'https://www.facebook.com/sharer/sharer.php?u={url}',popupWidth:600,popupHeight:500},twitter:{popupUrl:'https://twitter.com/intent/tweet?url={url}&text={title}',popupWidth:600,popupHeight:450,},mailru:{counterUrl:protocol+'//connect.mail.ru/share_count?url_list={url}&callback=1&func=?',convertNumber:function(data){for(var url in data){if(data.hasOwnProperty(url)){return data[url].shares;}}},popupUrl:protocol+'//connect.mail.ru/share?share_url={url}&title={title}',popupWidth:550,popupHeight:360},vkontakte:{counterUrl:'https://vk.com/share.php?act=count&url={url}&index={index}',counter:function(jsonUrl,deferred){var options=services.vkontakte;if(!options._){options._=[];if(!window.VK)window.VK={};window.VK.Share={count:function(idx,number){options._[idx].resolve(number);}};}var index=options._.length;options._.push(deferred);$.getScript(makeUrl(jsonUrl,{index:index})).fail(deferred.reject);},popupUrl:protocol+'//vk.com/share.php?url={url}&title={title}',popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:protocol+"//connect.ok.ru/dk?st.cmd=extLike&ref={url}&uid={index}&callback=?",counter:function(t,n){var i=services.odnoklassniki;i._||(i._=[],window.ODKL||(window.ODKL={}),window.ODKL.updateCount=function(e,t){i._[e].resolve(t)});var s=i._.length;i._.push(n),$.ajax({url:makeUrl(t,{index:s}),dataType:"jsonp"})},popupUrl:protocol+"//ok.ru/dk?st.cmd=addShare&st._surl={url}",popupWidth:550,popupHeight:360},plusone:{popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:protocol+'//api.pinterest.com/v1/urls/count.json?url={url}&callback=?',convertNumber:function(data){return data.count;},popupUrl:protocol+'//pinterest.com/pin/create/button/?url={url}&description={title}',popupWidth:630,popupHeight:270}};var counters={promises:{},fetch:function(service,url,extraOptions){if(!counters.promises[service])counters.promises[service]={};var servicePromises=counters.promises[service];if(!extraOptions.forceUpdate&&servicePromises[url]){return servicePromises[url];}else{var options=$.extend({},services[service],extraOptions);var deferred=$.Deferred();var jsonUrl=options.counterUrl&&makeUrl(options.counterUrl,{url:url});if(jsonUrl&&$.isFunction(options.counter)){options.counter(jsonUrl,deferred);}else if(options.counterUrl){$.getJSON(jsonUrl).done(function(data){try{var number=data;if($.isFunction(options.convertNumber)){number=options.convertNumber(data);}deferred.resolve(number);}catch(e){deferred.reject();}}).fail(deferred.reject);}else{deferred.reject();}servicePromises[url]=deferred.promise();return servicePromises[url];}}};$.fn.socialLikes=function(options){return this.each(function(){var elem=$(this);var instance=elem.data(prefix);if(instance){if($.isPlainObject(options)){instance.update(options);}}else{instance=new SocialLikes(elem,$.extend({},$.fn.socialLikes.defaults,options,dataToOptions(elem)));elem.data(prefix,instance);}});};$.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,''),title:document.title,counters:true,zeroes:false,wait:500,popupCheckInterval:500,singleTitle:'Share',twitterName:'@kinoprofinet'};function SocialLikes(container,options){this.container=container;this.options=options;this.init();}SocialLikes.prototype={init:function(){this.container.addClass(prefix);this.single=this.container.hasClass(prefix+'_single');this.initUserButtons();this.countersLeft=0;this.number=0;this.container.on('counter.'+prefix,$.proxy(this.updateCounter,this));var buttons=this.container.children();this.makeSingleButton();this.buttons=[];buttons.each($.proxy(function(idx,elem){var button=new Button($(elem),this.options);this.buttons.push(button);if(button.options.counterUrl)this.countersLeft++;},this));if(this.options.counters){this.timer=setTimeout($.proxy(this.appear,this),this.options.wait);}else{this.appear();}},initUserButtons:function(){if(!this.userButtonInited&&window.socialLikesButtons){$.extend(true,services,socialLikesButtons);}this.userButtonInited=true;},makeSingleButton:function(){if(!this.single)return;var container=this.container;container.addClass(prefix+'_vertical');container.wrap($('<div>',{'class':prefix+'_single-w'}));container.wrapInner($('<div>',{'class':prefix+'__single-container'}));var wrapper=container.parent();var widget=$('<div>',{'class':getElementClassNames('widget','single')});var button=$(template('<div class="{buttonCls}">'+'<span class="{iconCls}"></span>'+'{title}'+'</div>',{buttonCls:getElementClassNames('button','single'),iconCls:getElementClassNames('icon','single'),title:this.options.singleTitle}));widget.append(button);wrapper.append(widget);widget.on('click',function(){var activeClass=prefix+'__widget_active';widget.toggleClass(activeClass);if(widget.hasClass(activeClass)){container.css({left:-(container.width()-widget.width())/2,top:-container.height()});showInViewport(container);closeOnClick(container,function(){widget.removeClass(activeClass);});}else{container.removeClass(openClass);}return false;});this.widget=widget;},update:function(options){if(!options.forceUpdate&&options.url===this.options.url)return;this.number=0;this.countersLeft=this.buttons.length;if(this.widget)this.widget.find('.'+prefix+'__counter').remove();$.extend(this.options,options);for(var buttonIdx=0;buttonIdx<this.buttons.length;buttonIdx++){this.buttons[buttonIdx].update(options);}},updateCounter:function(e,service,number){if(number){this.number+=number;if(this.single){this.getCounterElem().text(this.number);}}this.countersLeft--;if(this.countersLeft===0){this.appear();this.container.addClass(prefix+'_ready');this.container.trigger('ready.'+prefix,this.number);}},appear:function(){this.container.addClass(prefix+'_visible');},getCounterElem:function(){var counterElem=this.widget.find('.'+classPrefix+'counter_single');if(!counterElem.length){counterElem=$('<span>',{'class':getElementClassNames('counter','single')});this.widget.append(counterElem);}return counterElem;}};function Button(widget,options){this.widget=widget;this.options=$.extend({},options);this.detectService();if(this.service){this.init();}}Button.prototype={init:function(){this.detectParams();this.initHtml();setTimeout($.proxy(this.initCounter,this),0);},update:function(options){$.extend(this.options,{forceUpdate:false},options);this.widget.find('.'+prefix+'__counter').remove();this.initCounter();},detectService:function(){var service=this.widget.data('service');if(!service){var node=this.widget[0];var classes=node.classList||node.className.split(' ');for(var classIdx=0;classIdx<classes.length;classIdx++){var cls=classes[classIdx];if(services[cls]){service=cls;break;}}if(!service)return;}this.service=service;$.extend(this.options,services[service]);},detectParams:function(){var data=this.widget.data();if(data.counter){var number=parseInt(data.counter,10);if(isNaN(number)){this.options.counterUrl=data.counter;}else{this.options.counterNumber=number;}}if(data.title){this.options.title=data.title;}if(data.url){this.options.url=data.url;}},initHtml:function(){var options=this.options;var widget=this.widget;var a=widget.find('a');if(a.length){this.cloneDataAttrs(a,widget);}var button=$('<span>',{'class':this.getElementClassNames('button'),'text':widget.text()});if(options.clickUrl){var url=makeUrl(options.clickUrl,{url:options.url,title:options.title});var link=$('<a>',{href:url});this.cloneDataAttrs(widget,link);widget.replaceWith(link);this.widget=widget=link;}else{widget.on('click',$.proxy(this.click,this));}widget.removeClass(this.service);widget.addClass(this.getElementClassNames('widget'));button.prepend($('<span>',{'class':this.getElementClassNames('icon')}));widget.empty().append(button);this.button=button;},initCounter:function(){if(this.options.counters){if(this.options.counterNumber){this.updateCounter(this.options.counterNumber);}else{var extraOptions={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};counters.fetch(this.service,this.options.url,extraOptions).always($.proxy(this.updateCounter,this));}}},cloneDataAttrs:function(source,destination){var data=source.data();for(var key in data){if(data.hasOwnProperty(key)){destination.data(key,data[key]);}}},getElementClassNames:function(elem){return getElementClassNames(elem,this.service);},updateCounter:function(number){number=parseInt(number,10)||0;var params={'class':this.getElementClassNames('counter'),'text':number};if(!number&&!this.options.zeroes){params['class']+=' '+prefix+'__counter_empty';params.text='';}var counterElem=$('<span>',params);this.widget.append(counterElem);this.widget.trigger('counter.'+prefix,[this.service,number]);},click:function(e){var options=this.options;var process=true;if($.isFunction(options.click)){process=options.click.call(this,e);}if(process){var url=makeUrl(options.popupUrl,{url:options.url,title:options.title});url=this.addAdditionalParamsToUrl(url);this.openPopup(url,{width:options.popupWidth,height:options.popupHeight});}return false;},addAdditionalParamsToUrl:function(url){var params=$.param($.extend(this.widget.data(),this.options.data));if($.isEmptyObject(params))return url;var glue=url.indexOf('?')===-1?'?':'&';return url+glue+params;},openPopup:function(url,params){var left=Math.round(screen.width/2-params.width/2);var top=0;if(screen.height>params.height){top=Math.round(screen.height/3-params.height/2);}var win=window.open(url,'sl_'+this.service,'left='+left+',top='+top+','+'width='+params.width+',height='+params.height+',personalbar=0,toolbar=0,scrollbars=1,resizable=1');if(win){win.focus();this.widget.trigger('popup_opened.'+prefix,[this.service,win]);var timer=setInterval($.proxy(function(){if(!win.closed)return;clearInterval(timer);this.widget.trigger('popup_closed.'+prefix,this.service);},this),this.options.popupCheckInterval);}else{location.href=url;}}};function dataToOptions(elem){function upper(m,l){return l.toUpper();}var options={};var data=elem.data();for(var key in data){var value=data[key];if(value==='yes')value=true;else if(value==='no')value=false;options[key.replace(/-(\w)/g,upper)]=value;}return options;}function makeUrl(url,context){return template(url,context,encodeURIComponent);}function template(tmpl,context,filter){return tmpl.replace(/\{([^\}]+)\}/g,function(m,key){return key in context?(filter?filter(context[key]):context[key]):m;});}function getElementClassNames(elem,mod){var cls=classPrefix+elem;return cls+' '+cls+'_'+mod;}function closeOnClick(elem,callback){function handler(e){if((e.type==='keydown'&&e.which!==27)||$(e.target).closest(elem).length)return;elem.removeClass(openClass);doc.off(events,handler);if($.isFunction(callback))callback();}var doc=$(document);var events='click touchstart keydown';doc.on(events,handler);}function showInViewport(elem){var offset=10;if(document.documentElement.getBoundingClientRect){var left=parseInt(elem.css('left'),10);var top=parseInt(elem.css('top'),10);var rect=elem[0].getBoundingClientRect();if(rect.left<offset)elem.css('left',offset-rect.left+left);else if(rect.right>window.innerWidth-offset)elem.css('left',window.innerWidth-rect.right-offset+left);if(rect.top<offset)elem.css('top',offset-rect.top+top);else if(rect.bottom>window.innerHeight-offset)elem.css('top',window.innerHeight-rect.bottom-offset+top);}elem.addClass(openClass);}$(function(){$('.'+prefix).socialLikes();});}));var reformalOptions={project_id:943714,show_tab:false,project_host:"idea.kinoprofi.net"};$(document).ready(function(){(function(){var script=document.createElement('script');script.type='text/javascript';script.async=true;script.src=('https:'==document.location.protocol?'https://':'http://')+'media.reformal.ru/widgets/v3/reformal.js';document.getElementsByTagName('head')[0].appendChild(script);})();$('.idea').mouseover(function(){if(typeof Reformal=="object"&&typeof Reformal.widgetPreload=="function"){Reformal.widgetPreload();}}).click(function(){if(typeof Reformal=="object"&&typeof Reformal.widgetOpen=="function"){Reformal.widgetOpen();}return false;});});$(document).ready(function(){var $news_id=0;var $related_cache='';var $api_rec_url="/engine/ajax/recomendation.php";$("#recomendation").click(function(){$news_id=$(this).data('mid');if($related_cache==''){$related_cache=$('.related-news').html();}if(!$news_id){return false;}$(document).on('click','.rec_wrapper .close',function(){$('.related-news').fadeOut(200,function(){$(this).html($related_cache).fadeIn(200);});});$(document).on('click','.btnaddrecom',function(){var $fid=$(this).data('fid');add_movie_recom($news_id,$fid,function(result){$('.recom_you').html(result);if($('ul.recom_you').find('li').length){$('ul.recom_you').parent('div.hl').fadeIn(200);}else{$('ul.recom_you').parent('div.hl').fadeOut(200);}});});$(document).on('click','.btndelrecom',function(){$(this).parents('li').fadeOut(500).remove();del_movie_recom($(this).data('rid'),$news_id,function(result){$('.recom_you').html(result);});});$.get($api_rec_url,{act:'selector',news_id:$news_id},function(data){$(".related-news").fadeOut(200,function(){$(this).html(data).fadeIn(200);if($('ul.recom_other').find('li').length){$('ul.recom_other').parent('div.hl').fadeIn(200);}else{$('ul.recom_other').parent('div.hl').fadeOut(200);}if($('ul.recom_you').find('li').length){$('ul.recom_you').parent('div.hl').fadeIn(200);}else{$('ul.recom_you').parent('div.hl').fadeOut(200);}$("#recac").autocomplete({minChars:2,params:{news_id:$news_id},serviceUrl:$api_rec_url,onSelect:function(suggestion){$(this).val('');add_movie_recom($news_id,suggestion.data,function(result){$('ul.recom_you').html(result);if($('ul.recom_you').find('li').length){$('ul.recom_you').parent('div.hl').fadeIn(200);}else{$('ul.recom_you').parent('div.hl').fadeOut(200);}});}});});});});function add_movie_recom(news_id,recom_id,callback_ok,callback_error){$.get($api_rec_url,{act:'addrecom',news_id:news_id,recom_id:recom_id},function(data){if(data.status=='error'){if(typeof callback_error=="function"){callback_error(data);}}else{if(typeof callback_ok=="function"){callback_ok(data.content);}}});}function del_movie_recom(recom_id,news_id,callback_ok,callback_error){$.get($api_rec_url,{act:'delrecom',news_id:news_id,recom_id:recom_id},function(data){if(data.status=='error'){if(typeof callback_error=="function"){callback_error(data);}}else{if(typeof callback_ok=="function"){callback_ok(data.content);}}});if($('ul.recom_you').find('li').length){$('ul.recom_you').parent('div.hl').fadeIn(200);}else{$('ul.recom_you').parent('div.hl').fadeOut(200);}}});var nodechat=($.cookie("kp_nodechat"))?$.cookie("kp_nodechat").split("_"):"1_450_275_155_15_1_0".split("_");jQuery.cachedScript=function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});return jQuery.ajax(options);};$(function(){if($.browser.mobile){return false;}if(dle_group==5){return false;}$.cachedScript("http://chat.kinoprofi.net:9091/socket.io/socket.io.js").done(function(){socket=io.connect('http://chat.kinoprofi.net:9091');if(nodechat[6]==2){nodechat[6]=($(window).width()>=1550)?1:0;}$('#nodechat_btn').click(function(){if(nodechat[0]==1){nodechat_close();nodechat[0]=0;}else{nodechat_open();nodechat[0]=1;}nodechat_setings_save();return false;});socket.on('chat_join',function(){if(nodechat[0]=="1"){nodechat_open();$('#nodechat_btn').addClass("onChat");}});socket.on('chat_init',function(data){$('#nodechat').remove();if(nodechat[6]==1){$('body').prepend(data);}else{$('#nodechat_wrapper').prepend(data);}nodechat_init();});socket.on('chat_msg2client',function(data){if(data.info){$('#nodechat_msg_list').prepend(data.info);setTimeout(function(){$('.nodechat_info').fadeTo(750,0,function(){$('div').remove('.nodechat_info');});},5000);}else{if(data.del){$('#nodechat_mess_'+data.del).remove();}if(data.message){$('#nodechat_msg_list').prepend(data.message);if(dle_group>2){$('a').remove('.nodechat_mess_del');}}}$('#nodechat_msg_list').getNiceScroll().resize();});},true);});function nodechat_open(){socket.emit('join2chat');$('#nodechat_btn').addClass("onchat");}function nodechat_close(){socket.emit('leave_chat');$('#nodechat').hide("scale",200,function(){$('#nodechat_btn').removeClass("onchat");$('.nicescroll-rails').remove();$(this).remove();});}function nodechat_location(){}function nodechat_setings_save(){$.cookie("kp_nodechat",nodechat.join("_"),{expires:365,path:'/'});}function nodechat_init(){nodechat_input();if(dle_group>2){$('a').remove('.nodechat_mess_del');}if(nodechat[6]==1){$('#nodechat').css({height:nodechat[1]}).css({width:nodechat[2]});nodechat_messheight();$('#nodechat').css({position:"fixed"});$('#nodechat').resizable({minHeight:200,minWidth:237,helper:'ui-resizable-helper',stop:function(event,ui){nodechat[1]=ui.size.height-2;nodechat[2]=ui.size.width-2;nodechat_messheight();nodechat_setings_save();}}).draggable({handle:'#nodechat_head',containment:'document',scroll:false,stop:function(event,ui){nodechat[3]=ui.offset.top-$(document).scrollTop();nodechat[4]=ui.offset.left-$(document).scrollLeft();nodechat_setings_save();}}).css({top:nodechat[3]+'px',left:nodechat[4]+'px'});}else{$('#nodechat').css({height:'480px'});}$('#nodechat').show("scale",200,function(){$(this).find('#nodechat_msg_list').niceScroll();});$('#nodechat_icons_close').click(function(){nodechat_close();nodechat[0]=0;nodechat_setings_save();return false;});$('#nodechat_icons_newwin').click(function(){if(nodechat[6]=="1"){nodechat[6]=0;}else{nodechat[6]=1;}nodechat_setings_save();$('#nodechat').remove();nodechat_open();nodechat_init();return false;});}function nodechat_messheight(){$('#nodechat_msg_list').css({height:nodechat[1]-106+'px'});}function nodechat_input(){ctrl=false;$('#nodechat_input').keydown(function(event){switch(event.which){case 13:return false;case 17:ctrl=true;}}).keyup(function(event){switch(event.which){case 13:if(!ctrl){nodechat_mess_send();return false;}$('#nodechat_input').focus().val($('#nodechat_input').val()+'\r\n');break;case 17:ctrl=false;}}).attr({placeholder:'РўРµРєСЃС‚ СЃРѕРѕР±С‰РµРЅРёСЏ ...'});}function nodechat_mess_send(){var txt=$('#nodechat_input').val();$('#nodechat_input').val('');socket.emit('chat_msg2server',txt);}function nodechat_mess_del(id){socket.emit('del_msg',id);return false;}function nodechat_reply(user){$('#nodechat_input').focus().val($('#nodechat_input').val()+'[to]'+user+'[/to], ');return false;}var timer_of_nodechat=[];function nodechat_action(id){$('#nodechat_date_'+id).hide();$('#nodechat_edit_'+id).show();timer_of_nodechat[id]=setTimeout(function(){$('#nodechat_edit_'+id).hide();$('#nodechat_date_'+id).show();},8000);return false;};